-- Mys2 Hub | Xeno-Compatible GUI (Optimized Brainrot Gods & Mythics ESP)

local player = game.Players.LocalPlayer
repeat wait() until player.Character and player.Character:FindFirstChild("HumanoidRootPart")
local char = player.Character
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:FindFirstChildOfClass("Humanoid") or char:WaitForChild("Humanoid")

local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local HttpService = game:GetService("HttpService")

local speedEnabled = false
local desiredSpeed = 90

-- Discord Integration
local discordInvite = "https://discord.gg/spnTPXSvMk"
local discordWebhook = "https://discord.com/api/webhooks/1396066702965346316/NDb7LEGDE9b5y3ymYEyuJcJdfOm8xotkuGNVsqTbfxkFmH4PKEsRc5GWaROkA8iZBqU6"

-- GUI Setup
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "Mys2Hub"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 200, 0, 500)
frame.Position = UDim2.new(0, 20, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
title.Text = "Mys2 Hub"
title.TextColor3 = Color3.new(1, 1, 1)
title.Font = Enum.Font.GothamBold
title.TextSize = 16

local nextButtonY = 40
function autoToggle(name, callback)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, nextButtonY)
    btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.Text = name .. ": OFF"

    local enabled = false
    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        btn.Text = name .. ": " .. (enabled and "ON" or "OFF")
        callback(enabled)
    end)

    nextButtonY = nextButtonY + 40
end

function autoButton(name, callback)
    local btn = Instance.new("TextButton", frame)
    btn.Size = UDim2.new(1, -20, 0, 30)
    btn.Position = UDim2.new(0, 10, 0, nextButtonY)
    btn.BackgroundColor3 = Color3.fromRGB(60, 0, 0)
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 14
    btn.Text = name
    btn.MouseButton1Click:Connect(callback)

    nextButtonY = nextButtonY + 40
end

-- Speed logic
local speedConnection

local function enforceSpeed()
    if speedEnabled and humanoid and humanoid.Parent then
        humanoid.WalkSpeed = desiredSpeed
    elseif humanoid then
        humanoid.WalkSpeed = 16
    end
end

local function startSpeedEnforcement()
    if speedConnection then speedConnection:Disconnect() end
    speedConnection = RunService.Heartbeat:Connect(enforceSpeed)
end

local function stopSpeedEnforcement()
    if speedConnection then
        speedConnection:Disconnect()
        speedConnection = nil
    end
    if humanoid then
        humanoid.WalkSpeed = 16
    end
end

local function tpUp()
    if hrp then
        local pos = hrp.Position
        hrp.CFrame = CFrame.new(pos.X, 300, pos.Z)
    end
end

local function tpDown()
    if hrp then
        local pos = hrp.Position
        hrp.CFrame = CFrame.new(pos.X, 10, pos.Z)
    end
end

local function teleportToClosest()
    local closest, dist = nil, math.huge
    for _, other in pairs(game.Players:GetPlayers()) do
        if other ~= player and other.Character and other.Character:FindFirstChild("HumanoidRootPart") then
            local d = (hrp.Position - other.Character.HumanoidRootPart.Position).Magnitude
            if d < dist then
                dist = d
                closest = other
            end
        end
    end
    if closest then
        hrp.CFrame = closest.Character.HumanoidRootPart.CFrame * CFrame.new(0, 5, 0)
    end
end

-- Player ESP Setup
local espEnabled = false
local espBoxes = {}

local function createBoxForPlayer(plr)
    local box = Drawing.new("Square")
    box.Visible = false
    box.Color = Color3.new(1, 0, 0)
    box.Thickness = 1
    box.Filled = false
    return box
end

-- Improved Mythics and Brainrot Gods ESP (optimized for lag and correctness)
local mythicRates = {
    ["Frigo Camelo"] = "1.2K$/sec — Sells for 300K",
    ["Orangutini Ananassini"] = "1.7K$/sec — Sells for 400K",
    ["Rhino Toasterino"] = "2.1K$/sec — Sells for 450K",
    ["Bombardiro Crocodilo"] = "2.5K$/sec — Sells for 500K",
    ["Bombombini Gusini"] = "5K$/sec — Sells for 1M",
    ["Cavallo Virtuoso"] = "7.5K$/sec — Sells for 2.5M",
    ["Spioniro Golubiro"] = "3.5K$/sec — Sells for 750K",
    ["Zibra Zubra Zibralini"] = "6K$/sec — Sells for 1M",
    ["Tigrilini Watermelini"] = "7.5K$/sec — Sells for 1M"
}

local brainrotGodRates = {
    ["Cocofanto Elefanto"] = "10K$/sec — Sells for 5M",
    ["Girafa Celestre"] = "20K$/sec — Sells for 7.5M",
    ["Gattatino Neonino"] = "35K$/sec — Sells for 7.5M",
    ["Matteo"] = "50K$/sec — Sells for 10M",
    ["Tralalero Tralala"] = "50K$/sec — Sells for 10M",
    ["Espresso Signora"] = "70K$/sec — Sells for 25M",
    ["Odin Din Din Dun"] = "75K$/sec — Sells for 15M",
    ["Statutino Libertino"] = "75K$/sec — Sells for 20M",
    ["Trenostruzzo Turbo 3000"] = "150K$/sec — Sells for 25M",
    ["Ballerino Lololo"] = "200K$/sec — Sells for 35M",
    ["Tigroligre Frutonni"] = "60K$/sec — Sells for 15M",
    ["Orcalero Orcala"] = "100K$/sec — Sells for 15M"
}

local mythicsESPEnabled = false
local godsESPEnabled = false
local mythicLabels = {}
local godLabels = {}

local function createLabel(color)
    local label = Drawing.new("Text")
    label.Size = 16
    label.Center = true
    label.Outline = true
    label.Visible = false
    label.Color = color
    return label
end

local function addESPLabel(npc, text, color, labelTable)
    if labelTable[npc] then return end
    local label = createLabel(color)
    label.Text = text
    labelTable[npc] = label
end

local function removeESPLabel(npc, labelTable)
    local label = labelTable[npc]
    if label then
        label.Visible = false
        label:Remove()
        labelTable[npc] = nil
    end
end

local function scanForNPCs()
    for _, npc in pairs(Workspace:GetChildren()) do
        if npc:IsA("Model") and npc:FindFirstChild("HumanoidRootPart") then
            local name = npc.Name
            if mythicRates[name] and mythicsESPEnabled and not mythicLabels[npc] then
                addESPLabel(npc, name .. " — " .. mythicRates[name], Color3.new(1, 0, 1), mythicLabels)
            elseif brainrotGodRates[name] and godsESPEnabled and not godLabels[npc] then
                addESPLabel(npc, name .. " — " .. brainrotGodRates[name], Color3.new(0, 0.7, 1), godLabels)
            end
        end
    end
end

local function cleanupLabels()
    for npc in pairs(mythicLabels) do
        if not npc.Parent or not mythicsESPEnabled then
            removeESPLabel(npc, mythicLabels)
        end
    end
    for npc in pairs(godLabels) do
        if not npc.Parent or not godsESPEnabled then
            removeESPLabel(npc, godLabels)
        end
    end
end

-- Update ESP labels positions every frame
RunService.RenderStepped:Connect(function()
    if espEnabled then
        -- Player ESP
        for plr, box in pairs(espBoxes) do
            local char = plr.Character
            local hrpPlr = char and char:FindFirstChild("HumanoidRootPart")
            if hrpPlr and hrpPlr.Parent then
                local screenPos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrpPlr.Position)
                if onScreen then
                    box.Position = Vector2.new(screenPos.X - 25, screenPos.Y - 25)
                    box.Size = Vector2.new(50, 50)
                    box.Visible = true
                else
                    box.Visible = false
                end
            else
                box.Visible = false
            end
        end
    else
        for _, box in pairs(espBoxes) do
            box.Visible = false
        end
    end

    -- Mythics and Gods ESP
    if mythicsESPEnabled or godsESPEnabled then
        scanForNPCs()
        cleanupLabels()

        for npc, label in pairs(mythicLabels) do
            if npc and npc.Parent then
                local hrpNPC = npc:FindFirstChild("HumanoidRootPart")
                if hrpNPC then
                    local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrpNPC.Position)
                    if onScreen then
                        label.Position = Vector2.new(pos.X, pos.Y - 30)
                        label.Visible = true
                    else
                        label.Visible = false
                    end
                else
                    label.Visible = false
                end
            else
                removeESPLabel(npc, mythicLabels)
            end
        end

        for npc, label in pairs(godLabels) do
            if npc and npc.Parent then
                local hrpNPC = npc:FindFirstChild("HumanoidRootPart")
                if hrpNPC then
                    local pos, onScreen = workspace.CurrentCamera:WorldToViewportPoint(hrpNPC.Position)
                    if onScreen then
                        label.Position = Vector2.new(pos.X, pos.Y - 30)
                        label.Visible = true
                    else
                        label.Visible = false
                    end
                else
                    label.Visible = false
                end
            else
                removeESPLabel(npc, godLabels)
            end
        end
    else
        for npc in pairs(mythicLabels) do removeESPLabel(npc, mythicLabels) end
        for npc in pairs(godLabels) do removeESPLabel(npc, godLabels) end
    end
end)

-- GUI Buttons
autoToggle("Speed", function(enabled)
    speedEnabled = enabled
    if enabled then
        startSpeedEnforcement()
    else
        stopSpeedEnforcement()
    end
end)

autoToggle("Player ESP", function(enabled)
    espEnabled = enabled
    -- Initialize boxes for all players on toggle ON
    if enabled then
        for _, plr in pairs(game.Players:GetPlayers()) do
            if plr ~= player and not espBoxes[plr] then
                espBoxes[plr] = createBoxForPlayer(plr)
            end
        end
    else
        for _, box in pairs(espBoxes) do
            box.Visible = false
        end
    end
end)

autoToggle("Mythics ESP", function(enabled)
    mythicsESPEnabled = enabled
end)

autoToggle("Brainrot Gods ESP", function(enabled)
    godsESPEnabled = enabled
end)

autoButton("TP Up", tpUp)
autoButton("TP Down", tpDown)
autoButton("TP Closest Player", teleportToClosest)
autoButton("Server Hop", function()
    print("Server hopping... (feature needs implementation)")
end)

-- Discord webhook & popup
local function sendDiscordWebhookNotification()
    local data = {
        content = "**Mys2 Hub script loaded**\nUser: " .. player.Name,
        username = "Mys2 Hub Bot"
    }

    local success, err = pcall(function()
        HttpService:PostAsync(discordWebhook, HttpService:JSONEncode(data), Enum.HttpContentType.ApplicationJson)
    end)

    if not success then
        warn("Failed to send Discord webhook: " .. tostring(err))
    end
end

local function showDiscordPopup()
    local popupGui = Instance.new("ScreenGui", game.CoreGui)
    popupGui.Name = "DiscordInvitePopup"

    local popupFrame = Instance.new("Frame", popupGui)
    popupFrame.Size = UDim2.new(0, 300, 0, 150)
    popupFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
    popupFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    popupFrame.BorderSizePixel = 0
    popupFrame.Active = true
    popupFrame.Draggable = true

    local title = Instance.new("TextLabel", popupFrame)
    title.Size = UDim2.new(1, 0, 0, 30)
    title.BackgroundTransparency = 1
    title.Text = "Script Update Available!"
    title.TextColor3 = Color3.new(1, 1, 1)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 18

    local message = Instance.new("TextLabel", popupFrame)
    message.Size = UDim2.new(1, -20, 0, 70)
    message.Position = UDim2.new(0, 10, 0, 40)
    message.BackgroundTransparency = 1
    message.TextWrapped = true
    message.Text = "A new script update is available.\nJoin our Discord server to stay updated and get support!"
    message.TextColor3 = Color3.new(1, 1, 1)
    message.Font = Enum.Font.Gotham
    message.TextSize = 14

    local inviteButton = Instance.new("TextButton", popupFrame)
    inviteButton.Size = UDim2.new(0, 200, 0, 30)
    inviteButton.Position = UDim2.new(0.5, -100, 1, -50)
    inviteButton.BackgroundColor3 = Color3.fromRGB(114, 137, 218)
    inviteButton.Text = "Join Discord"
    inviteButton.TextColor3 = Color3.new(1, 1, 1)
    inviteButton.Font = Enum.Font.GothamBold
    inviteButton.TextSize = 16

    local closeButton = Instance.new("TextButton", popupFrame)
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -35, 0, 5)
    closeButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.new(1, 1, 1)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 18

    inviteButton.MouseButton1Click:Connect(function()
        if setclipboard then
            setclipboard(discordInvite)
        end
        print("Discord invite copied to clipboard!")
    end)

    closeButton.MouseButton1Click:Connect(function()
        popupGui:Destroy()
    end)
end

sendDiscordWebhookNotification()
showDiscordPopup()
